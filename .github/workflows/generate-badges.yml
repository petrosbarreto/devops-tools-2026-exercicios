name: Gerar Badges

on:
  workflow_run:
    workflows: ["Atualizar Ranking"]
    types: [completed]
  workflow_dispatch:

jobs:
  generate-badges:
    runs-on: ubuntu-latest
    
    permissions:
      contents: write
    
    steps:
      - name: Checkout
        uses: actions/checkout@v3
      
      - name: Gerar Badges SVG
        run: |
          mkdir -p .github/badges
          
          # Badge: Total de Alunos
          cat > .github/badges/alunos.svg << 'EOF'
          <svg xmlns="http://www.w3.org/2000/svg" width="140" height="20">
            <linearGradient id="b" x2="0" y2="100%">
              <stop offset="0" stop-color="#bbb" stop-opacity=".1"/>
              <stop offset="1" stop-opacity=".1"/>
            </linearGradient>
            <mask id="a">
              <rect width="140" height="20" rx="3" fill="#fff"/>
            </mask>
            <g mask="url(#a)">
              <path fill="#555" d="M0 0h70v20H0z"/>
              <path fill="#007ec6" d="M70 0h70v20H70z"/>
              <path fill="url(#b)" d="M0 0h140v20H0z"/>
            </g>
            <g fill="#fff" text-anchor="middle" font-family="DejaVu Sans,Verdana,Geneva,sans-serif" font-size="11">
              <text x="35" y="15" fill="#010101" fill-opacity=".3">alunos</text>
              <text x="35" y="14">alunos</text>
              <text x="104" y="15" fill="#010101" fill-opacity=".3">0</text>
              <text x="104" y="14">0</text>
            </g>
          </svg>
          EOF
          
          # Badge: Exercícios
          cat > .github/badges/exercicios.svg << 'EOF'
          <svg xmlns="http://www.w3.org/2000/svg" width="170" height="20">
            <linearGradient id="b" x2="0" y2="100%">
              <stop offset="0" stop-color="#bbb" stop-opacity=".1"/>
              <stop offset="1" stop-opacity=".1"/>
            </linearGradient>
            <mask id="a">
              <rect width="170" height="20" rx="3" fill="#fff"/>
            </mask>
            <g mask="url(#a)">
              <path fill="#555" d="M0 0h90v20H0z"/>
              <path fill="#4c1" d="M90 0h80v20H90z"/>
              <path fill="url(#b)" d="M0 0h170v20H0z"/>
            </g>
            <g fill="#fff" text-anchor="middle" font-family="DejaVu Sans,Verdana,Geneva,sans-serif" font-size="11">
              <text x="45" y="15" fill="#010101" fill-opacity=".3">exercícios</text>
              <text x="45" y="14">exercícios</text>
              <text x="129" y="15" fill="#010101" fill-opacity=".3">2/36</text>
              <text x="129" y="14">2/36</text>
            </g>
          </svg>
          EOF
          
          # Badge: Média da Turma
          cat > .github/badges/media.svg << 'EOF'
          <svg xmlns="http://www.w3.org/2000/svg" width="140" height="20">
            <linearGradient id="b" x2="0" y2="100%">
              <stop offset="0" stop-color="#bbb" stop-opacity=".1"/>
              <stop offset="1" stop-opacity=".1"/>
            </linearGradient>
            <mask id="a">
              <rect width="140" height="20" rx="3" fill="#fff"/>
            </mask>
            <g mask="url(#a)">
              <path fill="#555" d="M0 0h70v20H0z"/>
              <path fill="#dfb317" d="M70 0h70v20H70z"/>
              <path fill="url(#b)" d="M0 0h140v20H0z"/>
            </g>
            <g fill="#fff" text-anchor="middle" font-family="DejaVu Sans,Verdana,Geneva,sans-serif" font-size="11">
              <text x="35" y="15" fill="#010101" fill-opacity=".3">média</text>
              <text x="35" y="14">média</text>
              <text x="104" y="15" fill="#010101" fill-opacity=".3">-</text>
              <text x="104" y="14">-</text>
            </g>
          </svg>
          EOF
          
          echo "✅ Badges gerados!"
      
      - name: Commit badges
        run: |
          git config user.name "GitHub Actions Bot"
          git config user.email "actions@github.com"
          git add .github/badges/
          git diff --quiet && git diff --staged --quiet || git commit -m "chore: atualizar badges"
          git push
